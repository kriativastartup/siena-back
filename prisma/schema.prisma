generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model academic_year {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome           String?   @db.VarChar
  data_de_inicio DateTime? @db.Date
  data_de_fim    DateTime? @db.Date
  status         Boolean?  @default(true)
  escola_id      String?   @db.Uuid
  turma          turma[]
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  escola         escola?   @relation(fields: [escola_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_academic_year_escola")
}

model aluno {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  usuario_id        String              @unique @db.Uuid
  escola_id         String              @db.Uuid
  numero_aluno      String              @unique @db.VarChar(20)
  data_nascimento   DateTime            @db.Date
  genero            genero_enum?
  telefone          String?             @db.VarChar(20)
  endereco          String?             @db.VarChar(300)
  foto              String?             @db.VarChar(255)
  status            status_aluno?       @default(activo)
  data_criacao     DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  usuario           usuario             @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_aluno_usuario")
  aluno_encarregado aluno_encarregado[]
  matricula         matricula[]
  nota              nota[]
  aluno_turma       aluno_turma[]
  escola            escola?             @relation(fields: [escola_id], references: [id])

  @@index([numero_aluno], map: "idx_aluno_numero")
  @@index([usuario_id], map: "idx_aluno_usuario")
}

model aluno_encarregado {
  id              String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  aluno_id        String      @db.Uuid
  grau_parentesco String?     @db.VarChar(50)
  encarregado_id  String      @db.Uuid
  principal       Boolean?    @default(false)
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  aluno           aluno       @relation(fields: [aluno_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_aluno_encarregado_aluno")
  encarregado     encarregado @relation(fields: [encarregado_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_aluno_encarregado_encarregado")

  @@unique([aluno_id, encarregado_id], map: "uk_aluno_encarregado")
  @@index([aluno_id], map: "idx_aluno_encarregado_aluno")
  @@index([encarregado_id], map: "idx_aluno_encarregado_encarregado")
}

model disciplina {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  escola_id        String             @db.Uuid
  nome             String             @db.VarChar(100)
  codigo           String?             @db.VarChar(20)
  carga_horaria    Int?
  descricao        String?
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  escola           escola             @relation(fields: [escola_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_disciplina_escola")
  turma_disciplina turma_disciplina[]
  professor_turma  professor_turma[]
  nota             nota[]

  @@unique([escola_id, codigo], map: "uk_disciplina_codigo")
  @@index([escola_id, codigo], map: "idx_disciplina_codigo")
  @@index([escola_id], map: "idx_disciplina_escola")
}

model encarregado {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  usuario_id        String              @unique @db.Uuid
  escola_id         String?             @db.Uuid
  telefone          String?             @db.VarChar(20)
  profissao         String?             @db.VarChar(100)
  aluno_encarregado aluno_encarregado[]
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  escola            escola?             @relation(fields: [escola_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_encarregado_escola")
  usuario           usuario             @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_encarregado_usuario")

  @@index([usuario_id], map: "idx_encarregado_usuario")
}

model escola {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome          String          @db.VarChar(200)
  endereco      String?         @db.VarChar(300)
  telefone      String?         @db.VarChar(20)
  email         String?         @unique(map: "email_escola_unique") @db.VarChar(100)
  usuario_id    String          @unique @db.Uuid
  logo_url      String?         @db.VarChar(255)
  natureza      natureza?       @default(publica)
  nif           String?
  codigo_mec    String?
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  status        Boolean?        @default(true)
  usuario       usuario         @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_usuario")
  academic_year academic_year[]
  disciplina    disciplina[]
  professor     professor[]
  turma         turma[]
  encarregado   encarregado[]
  matricula     matricula[]
  aluno         aluno[]
}

model matricula {
  id             String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  aluno_id       String                 @db.Uuid
  turma_id       String                 @db.Uuid
  escola_id      String                 @db.Uuid
  data_matricula DateTime?              @default(dbgenerated("CURRENT_DATE")) @db.Date
  status         status_matricula_enum? @default(ATIVA)
  ano_letivo     String                 @db.VarChar(9)
  escola         escola                 @relation(fields: [escola_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_matricula_escola")
  aluno          aluno                  @relation(fields: [aluno_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_matricula_aluno")
  turma          turma                  @relation(fields: [turma_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_matricula_turma")

  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  @@unique([aluno_id, turma_id, ano_letivo], map: "uk_matricula_aluno_turma")
  @@index([aluno_id], map: "idx_matricula_aluno")
  @@index([status], map: "idx_matricula_status")
  @@index([turma_id], map: "idx_matricula_turma")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model nota {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  avaliacao_id  String     @db.Uuid
  disciplina_id String     @db.Uuid
  aluno_id      String     @db.Uuid
  nota_obtida   Float
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  disciplina    disciplina @relation(fields: [disciplina_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_nota_disciplina")
  avaliacao     avaliacao  @relation(fields: [avaliacao_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_nota_avaliacao")
  aluno         aluno      @relation(fields: [aluno_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_nota_aluno")
}

model avaliacao {
  id             String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  turma_id       String              @db.Uuid
  disciplina_id  String              @db.Uuid
  trimestre      Int
  tipo_avaliacao tipo_avaliacao_enum
  descricao      String?             @db.VarChar(255)
  data_avaliacao DateTime            @db.Date
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  nota           nota[]
}

model professor {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  usuario_id       String             @unique @db.Uuid
  escola_id        String             @db.Uuid
  numero_professor String             @unique @db.VarChar(20)
  especialidade    String?            @db.VarChar(100)
  data_contratacao DateTime?          @db.Date
  escola           escola             @relation(fields: [escola_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_professor_escola")
  usuario          usuario            @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_professor_usuario")
  turma_disciplina turma_disciplina[]
  professor_turma  professor_turma[]
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)

  @@index([escola_id], map: "idx_professor_escola")
  @@index([numero_professor], map: "idx_professor_numero")
  @@index([usuario_id], map: "idx_professor_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model turma {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  escola_id         String             @db.Uuid
  nome              String             @db.VarChar(100)
  ano_letivo        String             @db.VarChar(9)
  academic_year_id  String             @db.Uuid
  ano_escolaridade  Int
  capacidade_maxima Int                @default(30)
  matricula         matricula[]
  escola            escola             @relation(fields: [escola_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_turma_escola")
  academic_year     academic_year?     @relation(fields: [academic_year_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_turma_academic_year")
  turma_disciplina  turma_disciplina[]
  professor_turma   professor_turma[]
  aluno_turma       aluno_turma[]
  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)

  @@index([ano_letivo], map: "idx_turma_ano_letivo")
  @@index([escola_id], map: "idx_turma_escola")
}

model aluno_turma {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  aluno_id String @db.Uuid
  turma_id String @db.Uuid
  aluno aluno @relation(fields: [aluno_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_aluno_turma_aluno")
  turma turma @relation(fields: [turma_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_aluno_turma_turma")

  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)

  @@unique([aluno_id, turma_id], map: "uk_aluno_turma")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model turma_disciplina {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  turma_id      String     @db.Uuid
  disciplina_id String     @db.Uuid
  professor_id  String     @db.Uuid
  ano_letivo    String     @db.VarChar(9)
  trimestre     Int?
  disciplina    disciplina @relation(fields: [disciplina_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_turma_disciplina_disciplina")
  professor     professor  @relation(fields: [professor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_turma_disciplina_professor")
  turma         turma      @relation(fields: [turma_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_turma_disciplina_turma")

  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  @@unique([turma_id, disciplina_id, trimestre], map: "uk_turma_disciplina")
  @@index([ano_letivo], map: "idx_turma_disciplina_ano")
  @@index([professor_id], map: "idx_turma_disciplina_professor")
  @@index([turma_id], map: "idx_turma_disciplina_turma")
}

model professor_turma {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  professor_id  String     @db.Uuid
  turma_id      String     @db.Uuid
  disciplina_id String     @db.Uuid
  professor     professor  @relation(fields: [professor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_professor_turma_professor")
  turma         turma      @relation(fields: [turma_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_professor_turma_turma")
  disciplina    disciplina @relation(fields: [disciplina_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_professor_turma_disciplina")

  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  @@unique([professor_id, turma_id], map: "uk_professor_turma")
  @@index([professor_id], map: "idx_professor_turma_professor")
  @@index([turma_id], map: "idx_professor_turma_turma")
}

model usuario {
  id            String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome_completo String            @db.VarChar(200)
  email         String            @unique @db.VarChar(100)
  senha_hash    String
  tipo_usuario  tipo_usuario_enum
  ativo         Boolean?          @default(true)
  data_cadastro DateTime?         @default(now()) @db.Timestamp(6)
  aluno         aluno?
  encarregado   encarregado?
  escola        escola?
  professor     professor?

  data_criacao DateTime @default(now()) @db.Timestamp(6)
  data_atualizacao DateTime @default(now()) @updatedAt @db.Timestamp(6)
  @@index([email], map: "idx_usuario_email")
  @@index([tipo_usuario], map: "idx_usuario_tipo")
}

enum genero_enum {
  M
  F
  OUTRO
}

enum natureza {
  publica
  privada
  hibrida
}

/// This enum is commented in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
enum role {
  ADMIN
  TEACHER
  GUARDIAN
  STUDANT
}

enum status_aluno {
  activo
  transferido
  desistente
  concluinte
  suspendido
}

enum status_matricula_enum {
  ATIVA
  CONCLUIDA
  CANCELADA
  SUSPENSA
}

enum tipo_avaliacao_enum {
  PROVA
  TRABALHO
  EXAME
  TESTE
  PARTICIPACAO
  TAREFA
}

enum tipo_usuario_enum {
  ALUNO
  PROFESSOR
  ENCARREGADO
  ADMIN
  SUPER_ADMIN
  SECRETARIA
  COORDENADOR
  DIRETOR
}
